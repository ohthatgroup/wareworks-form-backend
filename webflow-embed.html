<div id="wareworks-application-container" style="
  width: 100%; 
  max-width: 100%; 
  margin: 0 auto;
  font-family: 'Figtree', sans-serif;
">
  <!-- Language and Disclaimer Section -->
  <div id="language-disclaimer" style="
    background: white; 
    border: 1px solid #e5e7eb; 
    border-radius: 0.75rem; 
    padding: 2rem; 
    margin: 0 auto 1.25rem; 
    max-width: 600px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  ">
    <!-- Language Tab Selector -->
    <div style="
      display: flex;
      margin-bottom: 0;
      border-bottom: none;
    ">
      <button
        id="english-button"
        onclick="selectLanguage('en')"
        aria-label="Select English"
        style="
          flex: 1;
          background: #131f5b;
          color: white;
          border: 1px solid #131f5b;
          padding: 1rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.2s ease;
          font-family: 'Figtree', sans-serif;
          border-top-left-radius: 0.75rem;
          border-bottom: 3px solid #131f5b;
          position: relative;
        "
        onmouseover="if(this.style.background !== 'rgb(19, 31, 91)') { this.style.background='#f3f4f6'; this.style.color='#374151'; }"
        onmouseout="if(this.style.background !== 'rgb(19, 31, 91)') { this.style.background='#ffffff'; this.style.color='#6b7280'; }"
        onfocus="this.style.outline='2px solid #60a5fa'; this.style.outlineOffset='2px'"
        onblur="this.style.outline='none'"
      >
        English
      </button>
      <button
        id="spanish-button"
        onclick="selectLanguage('es')"
        aria-label="Seleccionar Español"
        style="
          flex: 1;
          background: #ffffff;
          color: #6b7280;
          border: 1px solid #e5e7eb;
          border-left: none;
          border-bottom: 3px solid #e5e7eb;
          padding: 1rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.2s ease;
          font-family: 'Figtree', sans-serif;
          border-top-right-radius: 0.75rem;
          position: relative;
        "
        onmouseover="if(this.style.background !== 'rgb(19, 31, 91)') { this.style.background='#f3f4f6'; this.style.color='#374151'; }"
        onmouseout="if(this.style.background !== 'rgb(19, 31, 91)') { this.style.background='#ffffff'; this.style.color='#6b7280'; }"
        onfocus="this.style.outline='2px solid #60a5fa'; this.style.outlineOffset='2px'"
        onblur="this.style.outline='none'"
      >
        Español
      </button>
    </div>
    
    <!-- Scrollable Content Container -->
    <div class="scrollable-content" style="
      max-height: 400px;
      overflow-y: auto;
      margin-bottom: 1.5rem;
      padding: 2rem;
      padding-right: 2.5rem;
      background: white;
      border: 1px solid #e5e7eb;
      border-top: none;
      border-bottom-left-radius: 0.75rem;
      border-bottom-right-radius: 0.75rem;
    ">
      <!-- Employment Application Information -->
      <div style="margin-bottom: 1.5rem;">
        <h3 style="
          font-size: 1.125rem; 
          font-weight: 600; 
          color: #131f5b; 
          margin: 0 0 0.75rem 0;
        ">
          <span id="requirements-title-en">Employment Application Process</span>
          <span id="requirements-title-es" style="display: none;">Proceso de Solicitud de Empleo</span>
        </h3>
        <p style="
          color: #374151; 
          line-height: 1.6; 
          margin: 0 0 1rem 0;
        ">
          <span id="requirements-text-en">This comprehensive employment application will collect your personal information, work authorization status, employment history, education background, and required documentation. All information is necessary for employment consideration and legal compliance.</span>
          <span id="requirements-text-es" style="display: none;">Esta solicitud de empleo integral recopilará su información personal, estado de autorización de trabajo, historial laboral, antecedentes educativos y documentación requerida. Toda la información es necesaria para la consideración de empleo y el cumplimiento legal.</span>
        </p>
      </div>

      <!-- Work Authorization & I-9 Requirements -->
      <div style="margin-bottom: 1.5rem;">
        <h4 style="
          font-size: 1rem; 
          font-weight: 600; 
          color: #131f5b; 
          margin: 0 0 0.5rem 0;
        ">
          <span id="i9-title-en">Work Authorization & I-9 Verification</span>
          <span id="i9-title-es" style="display: none;">Autorización de Trabajo y Verificación I-9</span>
        </h4>
        <p style="
          color: #374151; 
          line-height: 1.6; 
          margin: 0 0 1rem 0;
          font-size: 0.9rem;
        ">
          <span id="i9-text-en">Federal law requires verification of identity and work authorization for all employees. You must provide acceptable I-9 documentation within three (3) business days of starting employment. This includes government-issued photo identification and proof of work authorization.</span>
          <span id="i9-text-es" style="display: none;">La ley federal requiere verificación de identidad y autorización de trabajo para todos los empleados. Debe proporcionar documentación I-9 aceptable dentro de tres (3) días hábiles de comenzar el empleo. Esto incluye identificación con foto emitida por el gobierno y prueba de autorización de trabajo.</span>
        </p>
      </div>

      <!-- Background Verification -->
      <div style="margin-bottom: 1.5rem;">
        <h4 style="
          font-size: 1rem; 
          font-weight: 600; 
          color: #131f5b; 
          margin: 0 0 0.5rem 0;
        ">
          <span id="background-title-en">Background Verification Process</span>
          <span id="background-title-es" style="display: none;">Proceso de Verificación de Antecedentes</span>
        </h4>
        <p style="
          color: #374151; 
          line-height: 1.6; 
          margin: 0 0 1rem 0;
          font-size: 0.9rem;
        ">
          <span id="background-text-en">We will conduct comprehensive background checks including employment history verification, reference checks, and criminal background screening. Previous employers and supervisors may be contacted to verify your work experience, job performance, and eligibility for rehire.</span>
          <span id="background-text-es" style="display: none;">Realizaremos verificaciones exhaustivas de antecedentes incluyendo verificación del historial laboral, verificación de referencias y verificación de antecedentes penales. Los empleadores anteriores y supervisores pueden ser contactados para verificar su experiencia laboral, desempeño en el trabajo y elegibilidad para recontratación.</span>
        </p>
      </div>

      <!-- Document Requirements -->
      <div style="margin-bottom: 1.5rem;">
        <h4 style="
          font-size: 1rem; 
          font-weight: 600; 
          color: #131f5b; 
          margin: 0 0 0.5rem 0;
        ">
          <span id="doc-title-en">Required Documentation</span>
          <span id="doc-title-es" style="display: none;">Documentación Requerida</span>
        </h4>
        <p style="
          color: #374151; 
          line-height: 1.6; 
          margin: 0;
          font-size: 0.9rem;
        ">
          <span id="doc-requirements-en">You will need to upload: (1) Government-issued photo ID, (2) Current resume, and (3) Any relevant certifications. Accepted formats: PDF, JPG, JPEG, PNG. Maximum file size: 10MB per file. All documents must be clear, legible, and show complete information.</span>
          <span id="doc-requirements-es" style="display: none;">Deberá subir: (1) Identificación con foto emitida por el gobierno, (2) Currículum actual, y (3) Cualquier certificación relevante. Formatos aceptados: PDF, JPG, JPEG, PNG. Tamaño máximo de archivo: 10MB por archivo. Todos los documentos deben ser claros, legibles y mostrar información completa.</span>
        </p>
      </div>

      <!-- Privacy Notice -->
      <div style="
        background: #f9fafb; 
        border: 1px solid #e5e7eb; 
        border-radius: 0.5rem; 
        padding: 1rem; 
        margin-bottom: 0;
      ">
        <h4 style="
          font-size: 1rem; 
          font-weight: 600; 
          color: #131f5b; 
          margin: 0 0 0.5rem 0;
        ">
          <span id="privacy-title-en">Privacy & Data Use Notice</span>
          <span id="privacy-title-es" style="display: none;">Aviso de Privacidad y Uso de Datos</span>
        </h4>
        <p style="
          color: #374151; 
          line-height: 1.6; 
          margin: 0;
          font-size: 0.875rem;
        ">
          <span id="privacy-notice-en">By continuing, you consent to the collection, use, and verification of all information provided including personal details, Social Security number, employment history, education records, and references. Information will be used for employment consideration, background verification, I-9 compliance, and maintained confidentially per applicable employment laws. Reference contacts and previous employers may be contacted for verification purposes.</span>
          <span id="privacy-notice-es" style="display: none;">Al continuar, usted consiente a la recopilación, uso y verificación de toda la información proporcionada incluyendo detalles personales, número de Seguro Social, historial laboral, registros educativos y referencias. La información será utilizada para consideración de empleo, verificación de antecedentes, cumplimiento I-9, y mantenida confidencialmente según las leyes laborales aplicables. Los contactos de referencia y empleadores anteriores pueden ser contactados para propósitos de verificación.</span>
        </p>
      </div>
    </div>

    <!-- Continue Button -->
    <button
      id="continue-button"
      onclick="continueToApplication()"
      style="
        width: 100%; 
        max-width: 320px;
        background: #131f5b; 
        color: white; 
        border: none;
        padding: 1rem 2rem; 
        border-radius: 0.5rem; 
        font-weight: 500; 
        font-size: 1rem;
        cursor: pointer; 
        transition: all 0.2s ease;
        font-family: 'Figtree', sans-serif;
        box-shadow: 0 4px 12px rgba(19, 31, 91, 0.15);
        display: block;
        margin: 0 auto;
      " 
      onmouseover="this.style.background='#1e308e'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 6px 20px rgba(19, 31, 91, 0.25)'" 
      onmouseout="this.style.background='#131f5b'; this.style.transform='none'; this.style.boxShadow='0 4px 12px rgba(19, 31, 91, 0.15)'"
    >
Accept & Continue
    </button>
  </div>
  
  <!-- Loading Section (hidden initially) -->
  <div id="loading-section" style="
    display: none; 
    text-align: center; 
    padding: 3rem 2rem;
  ">
    <div style="
      width: 48px; 
      height: 48px; 
      border: 4px solid #e5e7eb; 
      border-top: 4px solid #131f5b; 
      border-radius: 50%; 
      margin: 0 auto 1.5rem; 
      animation: spin 1s linear infinite;
    "></div>
    <h3 id="loading-title" style="
      font-size: 1.25rem; 
      font-weight: 600; 
      color: #131f5b; 
      margin: 0 0 0.5rem 0;
      font-family: 'Bricolage Grotesque', sans-serif;
    ">
      <span id="loading-title-en">Loading Application</span>
      <span id="loading-title-es" style="display: none;">Cargando Aplicación</span>
    </h3>
    <p id="loading-text" style="
      color: #6b7280; 
      line-height: 1.5;
      margin: 0;
    ">
      <span id="loading-text-en">Please wait while we prepare your application form...</span>
      <span id="loading-text-es" style="display: none;">Por favor espere mientras preparamos su formulario de aplicación...</span>
    </p>
  </div>

  <!-- Progress Bar Container (shown after language selection) -->
  <div id="progress-bar-container" style="display: none; width: 100%;">
    <!-- Progress bar will be injected here -->
  </div>

  <!-- Application Container -->
  <div id="application-container" style="display: none; width: 100%;">
    <!-- The standalone application will be loaded here -->
  </div>
</div>

<style>
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  @import url('https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Figtree:ital,wght@0,300..900;1,300..900&display=swap');
  
  /* Responsive styles following style guide breakpoints */
  @media (max-width: 768px) {
    #language-disclaimer {
      margin: 0 1rem 1.25rem !important;
      padding: 1.5rem !important;
    }
    
    #disclaimer-title {
      font-size: 1.375rem !important;
    }
  }
  
  @media (max-width: 480px) {
    #language-disclaimer {
      margin: 0 0.5rem 1.25rem !important;
      padding: 1.25rem !important;
    }
    
    .scrollable-content {
      max-height: 300px !important;
    }
  }
  
  /* Custom scrollbar styling */
  .scrollable-content::-webkit-scrollbar {
    width: 8px;
  }
  
  .scrollable-content::-webkit-scrollbar-track {
    background: #f1f3f4;
    border-radius: 4px;
  }
  
  .scrollable-content::-webkit-scrollbar-thumb {
    background: #c1c7cd;
    border-radius: 4px;
    transition: background 0.2s ease;
  }
  
  .scrollable-content::-webkit-scrollbar-thumb:hover {
    background: #a8aeb4;
  }
  
  /* Firefox scrollbar styling */
  .scrollable-content {
    scrollbar-width: thin;
    scrollbar-color: #c1c7cd #f1f3f4;
  }
</style>

<script>
(function() {
  'use strict';
  
  let selectedLanguage = 'en';
  
  // Configuration
  const CONFIG = {
    // Secure URL validation and construction
    FORM_APP_URL: (function() {
      const hostname = window.location.hostname;
      // Strict whitelist of allowed domains
      const allowedDomains = ['localhost', 'wareworks.me', 'webflow.io'];
      const isAllowedDomain = allowedDomains.some(domain => 
        hostname === domain || hostname.endsWith('.' + domain)
      );
      
      if (hostname === 'localhost') {
        return 'http://localhost:3000';
      } else if (isAllowedDomain) {
        return 'https://wareworks-backend.netlify.app';
      } else {
        // Fallback for unknown domains - use secure default
        console.warn('Unknown domain detected, using secure fallback');
        return 'https://wareworks-backend.netlify.app';
      }
    })(),
    ANALYTICS_ID: 'G-XXXXXXXXXX', // Replace with your GA4 ID
    WEBFLOW_DOMAIN: window.location.hostname
  };

  // Analytics tracking
  function trackEvent(eventName, parameters = {}) {
    if (typeof gtag !== 'undefined') {
      gtag('event', eventName, {
        ...parameters,
        source: 'webflow_embed',
        webflow_domain: CONFIG.WEBFLOW_DOMAIN
      });
    }
  }

  // Language selection
  window.selectLanguage = function(language) {
    selectedLanguage = language;
    
    // Update button styles
    const englishBtn = document.getElementById('english-button');
    const spanishBtn = document.getElementById('spanish-button');
    const continueBtn = document.getElementById('continue-button');
    
    // Show/hide content based on selected language
    const enElements = document.querySelectorAll('[id$="-en"]');
    const esElements = document.querySelectorAll('[id$="-es"]');
    
    if (language === 'en') {
      // English tab active
      englishBtn.style.setProperty('background', '#131f5b', 'important');
      englishBtn.style.setProperty('color', 'white', 'important');
      englishBtn.style.borderBottom = '3px solid #131f5b';
      englishBtn.style.borderLeft = '1px solid #131f5b';
      englishBtn.style.borderRight = '1px solid #131f5b';
      englishBtn.style.borderTop = '1px solid #131f5b';
      
      // Spanish tab inactive  
      spanishBtn.style.setProperty('background', '#ffffff', 'important');
      spanishBtn.style.setProperty('color', '#6b7280', 'important');
      spanishBtn.style.borderBottom = '3px solid #e5e7eb';
      spanishBtn.style.borderLeft = 'none';
      spanishBtn.style.borderRight = '1px solid #e5e7eb';
      spanishBtn.style.borderTop = '1px solid #e5e7eb';
      
      continueBtn.textContent = 'Accept & Continue';
      
      enElements.forEach(el => el.style.display = '');
      esElements.forEach(el => el.style.display = 'none');
    } else {
      // Spanish tab active
      spanishBtn.style.setProperty('background', '#131f5b', 'important');
      spanishBtn.style.setProperty('color', 'white', 'important');
      spanishBtn.style.borderBottom = '3px solid #131f5b';
      spanishBtn.style.borderLeft = 'none';
      spanishBtn.style.borderRight = '1px solid #131f5b';
      spanishBtn.style.borderTop = '1px solid #131f5b';
      
      // English tab inactive
      englishBtn.style.setProperty('background', '#ffffff', 'important');
      englishBtn.style.setProperty('color', '#6b7280', 'important');
      englishBtn.style.borderBottom = '3px solid #e5e7eb';
      englishBtn.style.borderLeft = '1px solid #e5e7eb';
      englishBtn.style.borderRight = 'none';
      englishBtn.style.borderTop = '1px solid #e5e7eb';
      
      continueBtn.textContent = 'Aceptar y Continuar';
      
      enElements.forEach(el => el.style.display = 'none');
      esElements.forEach(el => el.style.display = '');
    }
    
    trackEvent('language_selected', { language });
  }

  // Continue to application
  window.continueToApplication = function() {
    // Hide disclaimer and show loading
    document.getElementById('language-disclaimer').style.display = 'none';
    document.getElementById('loading-section').style.display = 'block';
    
    trackEvent('application_start', {
      language: selectedLanguage
    });
    
    setTimeout(() => loadApplication(), 500);
  }

  // Load the React application
  function loadApplication() {
    try {
      const iframe = document.createElement('iframe');
      iframe.src = `${CONFIG.FORM_APP_URL}?lang=${selectedLanguage}`;
      iframe.style.cssText = `
        width: 100%; 
        border: none; 
        height: 800px;
        background: transparent;
        display: block;
        overflow: hidden;
      `;
      iframe.onload = function() {
        document.getElementById('loading-section').style.display = 'none';
        document.getElementById('application-container').style.display = 'block';
        
        console.log('Iframe loaded, waiting for height messages...');
        trackEvent('application_loaded');
      };
      iframe.onerror = function() {
        console.error('Failed to load application');
        const loadingTextEn = document.getElementById('loading-text-en');
        const loadingTextEs = document.getElementById('loading-text-es');
        if (selectedLanguage === 'en') {
          loadingTextEn.textContent = 'Failed to load application. Please refresh and try again.';
        } else {
          loadingTextEs.textContent = 'Error al cargar la aplicación. Por favor actualice y vuelva a intentar.';
        }
      };
      
      document.getElementById('application-container').appendChild(iframe);
    } catch (error) {
      console.error('Error loading application:', error);
      const loadingTextEn = document.getElementById('loading-text-en');
      const loadingTextEs = document.getElementById('loading-text-es');
      if (selectedLanguage === 'en') {
        loadingTextEn.textContent = 'An error occurred. Please refresh and try again.';
      } else {
        loadingTextEs.textContent = 'Ocurrió un error. Por favor actualice y vuelva a intentar.';
      }
    }
  }

  // Set up progress bar communication
  window.addEventListener('message', function(event) {
    if (event.data.type === 'progressUpdate') {
      updateProgressBar(event.data.current, event.data.total);
    } else if (event.data.type === 'applicationComplete') {
      trackEvent('application_complete', {
        submission_id: event.data.submissionId
      });
    }
  }, false);

  // Handle iframe resize messages from the form
  window.addEventListener('message', function(event) {
    // Validate origin for security
    const allowedOrigins = [
      'http://localhost:3000',
      'http://localhost:3001', 
      'http://localhost:3002',
      'http://localhost:3003',
      'http://localhost:3004',
      'https://wareworks-backend.netlify.app'
    ];
    
    // Allow same origin
    if (event.origin !== window.location.origin && !allowedOrigins.includes(event.origin)) {
      return;
    }

    // Handle height resize messages
    if (event.data.type === 'iframe-resize' && event.data.source === 'wareworks-form') {
      const iframe = document.querySelector('#application-container iframe');
      if (iframe && event.data.height) {
        const newHeight = Math.max(600, parseInt(event.data.height) + 20);
        iframe.style.height = newHeight + 'px';
        console.log('Iframe resized to:', newHeight + 'px');
        
        // Also adjust the container if needed
        const container = document.getElementById('application-container');
        if (container) {
          container.style.minHeight = newHeight + 'px';
        }
      }
    }
    
    // Handle scroll-to-top messages from the iframe
    if (event.data.action === 'scrollToTop') {
      console.log('📜 Scroll to top requested from iframe');
      
      // Try multiple scroll methods for better compatibility
      try {
        // Method 1: Smooth scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
        // Method 2: Also scroll document elements
        document.documentElement.scrollTop = 0;
        document.body.scrollTop = 0;
        
        // Method 3: Try to scroll to the form container
        const container = document.getElementById('wareworks-application-container');
        if (container) {
          container.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        console.log('✅ Scroll to top executed');
      } catch (error) {
        console.warn('❌ Scroll to top failed:', error);
      }
    }
  }, false);

  function updateProgressBar(current, total) {
    // The React app now handles its own progress bar display
    // This function is kept for compatibility but no longer creates duplicate progress bars
    console.log('Progress update received:', { current, total });
  }

  console.log('✅ WareWorks embed initialized');
})();
</script>