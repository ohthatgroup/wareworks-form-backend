<!-- 
WareWorks Application Form - Webflow Embed Code
Copy this code into your Webflow embed element
-->

<div id="wareworks-application-embed" style="width: 100%; min-height: 600px;">
  <!-- Language Selection Disclaimer -->
  <div id="language-disclaimer" style="
    background: white; 
    border-radius: 0.75rem; 
    padding: 2.5rem; 
    text-align: center; 
    box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
    margin-bottom: 1.25rem; 
    max-width: 50rem; 
    margin: 0 auto 1.25rem;
    font-family: 'Figtree', sans-serif;
  ">
    <h2 style="
      color: #131f5b; 
      margin-bottom: 0.625rem; 
      font-family: 'Bricolage Grotesque', sans-serif; 
      font-size: 1.75rem;
      font-weight: 400;
      letter-spacing: -0.01em;
      line-height: 1.04em;
      margin-bottom: 0.35em;
    ">
      Welcome to WareWorks
    </h2>
    <h3 style="
      color: #666; 
      margin-bottom: 1.875rem; 
      font-family: 'Bricolage Grotesque', sans-serif; 
      font-size: 1.5rem; 
      font-weight: 400;
      letter-spacing: -0.01em;
      line-height: 1.04em;
      margin-bottom: 0.7em;
    ">
      Bienvenido a WareWorks
    </h3>
    
    <div style="
      text-align: left; 
      margin-bottom: 1.875rem; 
      line-height: 1.6; 
      background: #eff1f7; 
      padding: 1.25rem; 
      border-radius: 0.5rem;
    ">
      <p style="
        margin-bottom: 0.9375rem; 
        font-size: 0.88rem;
        font-family: 'Figtree', sans-serif;
        line-height: 1.6em;
        color: #080c24;
      ">
        <strong>English:</strong> By continuing, you acknowledge that the information you provide will be used for employment purposes and will be kept confidential according to applicable laws.
      </p>
      <p style="
        margin-bottom: 0; 
        font-size: 0.88rem;
        font-family: 'Figtree', sans-serif;
        line-height: 1.6em;
        color: #080c24;
      ">
        <strong>Español:</strong> Al continuar, usted reconoce que la información que proporcione será utilizada para fines de empleo y se mantendrá confidencial de acuerdo con las leyes aplicables.
      </p>
    </div>
    
    <p style="
      margin-bottom: 1.5625rem; 
      color: #666; 
      font-size: 1rem;
      font-family: 'Figtree', sans-serif;
      line-height: 1.6em;
    ">
      Please select your preferred language:
    </p>
    <div class="button-container" style="display: flex; gap: 0.9375rem; justify-content: center; flex-wrap: wrap;">
      <button onclick="loadApplicationEmbed('en')" style="
        background: #131f5b; 
        color: white; 
        border: none; 
        padding: 1em 1.5em; 
        border-radius: 0.25rem; 
        cursor: pointer; 
        font-size: 1rem; 
        min-width: 12.5rem; 
        transition: all 0.2s ease;
        font-family: 'Figtree', sans-serif;
        font-weight: 400;
      " onmouseover="this.style.background='#1e308e'; this.style.transform='translateY(-1px)'" onmouseout="this.style.background='#131f5b'; this.style.transform='none'">
        Accept & Continue in English
      </button>
      <button onclick="loadApplicationEmbed('es')" style="
        background: #131f5b; 
        color: white; 
        border: none; 
        padding: 1em 1.5em; 
        border-radius: 0.25rem; 
        cursor: pointer; 
        font-size: 1rem; 
        min-width: 12.5rem; 
        transition: all 0.2s ease;
        font-family: 'Figtree', sans-serif;
        font-weight: 400;
      " onmouseover="this.style.background='#1e308e'; this.style.transform='translateY(-1px)'" onmouseout="this.style.background='#131f5b'; this.style.transform='none'">
        Aceptar y Continuar en Español
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div id="application-loading" style="
    display: none; 
    text-align: center; 
    padding: 3rem;
    font-family: 'Figtree', sans-serif;
  ">
    <div style="
      width: 2.5rem; 
      height: 2.5rem; 
      border: 0.25rem solid #eff1f7; 
      border-top: 0.25rem solid #131f5b; 
      border-radius: 50%; 
      animation: spin 1s linear infinite; 
      margin: 0 auto 1rem;
    "></div>
    <p style="
      color: #666; 
      font-size: 1rem;
      font-family: 'Figtree', sans-serif;
      line-height: 1.6em;
      margin: 0;
    ">
      Loading application...
    </p>
  </div>

  <!-- Application Container -->
  <div id="application-container" style="display: none; width: 100%;">
    <!-- The standalone application will be loaded here -->
  </div>
</div>

<style>
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  @import url('https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Figtree:ital,wght@0,300..900;1,300..900&display=swap');
  
  /* Responsive styles following style guide breakpoints */
  @media (max-width: 768px) {
    #language-disclaimer {
      margin: 0 1rem 1.25rem !important;
      padding: 1.5rem !important;
    }
    
    #language-disclaimer h2 {
      font-size: 1.52rem !important;
    }
    
    #language-disclaimer h3 {
      font-size: 1.3rem !important;
    }
    
    #language-disclaimer .button-container {
      flex-direction: column !important;
    }
    
    #language-disclaimer button {
      min-width: 100% !important;
    }
  }
  
  @media (max-width: 480px) {
    #language-disclaimer h2 {
      font-size: 1.21rem !important;
    }
    
    #language-disclaimer h3 {
      font-size: 1.2rem !important;
    }
  }
</style>

<script>
(function() {
  'use strict';
  
  // Configuration
  const CONFIG = {
    // Use localhost for development, replace with your actual Netlify URL when deployed
    FORM_APP_URL: window.location.hostname === 'localhost' || window.location.hostname.includes('webflow.io') 
      ? 'http://localhost:3000' 
      : 'https://wareworks-backend.netlify.app', // Your actual Netlify URL
    ANALYTICS_ID: 'G-XXXXXXXXXX', // Replace with your GA4 ID
    WEBFLOW_DOMAIN: window.location.hostname
  };

  // Analytics tracking
  function trackEvent(eventName, parameters = {}) {
    if (typeof gtag !== 'undefined') {
      gtag('event', eventName, {
        ...parameters,
        source: 'webflow_embed',
        webflow_domain: CONFIG.WEBFLOW_DOMAIN
      });
    }
  }

  // Start application with language selection
  window.startApplication = function(language = 'en') {
    console.log('Starting WareWorks application in language:', language);
    
    // Track application start
    trackEvent('application_start', {
      language: language,
      referrer: CONFIG.WEBFLOW_DOMAIN
    });
    
    // Hide disclaimer, show loading
    document.getElementById('language-disclaimer').style.display = 'none';
    document.getElementById('application-loading').style.display = 'block';
    
    // Build application URL with parameters
    const url = new URL(CONFIG.FORM_APP_URL);
    url.searchParams.set('lang', language);
    url.searchParams.set('source', 'webflow');
    url.searchParams.set('referrer', CONFIG.WEBFLOW_DOMAIN);
    
    // Add UTM parameters if present
    const urlParams = new URLSearchParams(window.location.search);
    ['utm_source', 'utm_medium', 'utm_campaign', 'utm_content'].forEach(param => {
      if (urlParams.has(param)) {
        url.searchParams.set(param, urlParams.get(param));
      }
    });
    
    // Redirect to standalone application
    setTimeout(() => {
      window.location.href = url.toString();
    }, 500);
  };

  // Load application in iframe (embedded approach)
  window.loadApplicationEmbed = function(language = 'en') {
    console.log('Loading WareWorks application in iframe, language:', language);
    
    // Track application start
    trackEvent('application_start', {
      language: language,
      referrer: CONFIG.WEBFLOW_DOMAIN,
      mode: 'embedded'
    });
    
    const container = document.getElementById('application-container');
    const loading = document.getElementById('application-loading');
    const disclaimer = document.getElementById('language-disclaimer');
    
    // Show loading first
    disclaimer.style.display = 'none';
    loading.style.display = 'block';
    
    // After a brief moment, load the iframe
    setTimeout(() => {
      loading.style.display = 'none';
      container.style.display = 'block';
    
      // Build application URL with parameters
      const url = new URL(CONFIG.FORM_APP_URL);
      url.searchParams.set('lang', language);
      url.searchParams.set('embed', 'true');
      url.searchParams.set('source', 'webflow');
      url.searchParams.set('referrer', CONFIG.WEBFLOW_DOMAIN);
      
      // Add UTM parameters if present
      const urlParams = new URLSearchParams(window.location.search);
      ['utm_source', 'utm_medium', 'utm_campaign', 'utm_content'].forEach(param => {
        if (urlParams.has(param)) {
          url.searchParams.set(param, urlParams.get(param));
        }
      });
    
      // Create iframe
      const iframe = document.createElement('iframe');
      iframe.src = url.toString();
      iframe.style.width = '100%';
      iframe.style.height = '600px'; // Initial height, will be adjusted
      iframe.style.border = 'none';
      iframe.style.borderRadius = '8px';
      iframe.style.overflow = 'hidden';
      iframe.style.transition = 'height 0.3s ease';
      
      // Handle iframe messages for height adjustment
      window.addEventListener('message', function(event) {
        if (event.origin === new URL(CONFIG.FORM_APP_URL).origin) {
          if (event.data.type === 'resize') {
            const newHeight = event.data.height;
            iframe.style.height = newHeight + 'px';
            console.log('Iframe height adjusted to:', newHeight + 'px');
          }
          if (event.data.type === 'application_complete') {
            trackEvent('application_complete', event.data.details);
          }
        }
      });
      
      // Add onload event to request initial height
      iframe.onload = function() {
        console.log('Iframe loaded, requesting height adjustment');
        iframe.contentWindow.postMessage({ type: 'requestHeight' }, '*');
      };
      
      container.appendChild(iframe);
    }, 500);
  };

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      console.log('WareWorks application embed initialized');
    });
  }
})();
</script>

<!-- 
INSTRUCTIONS FOR WEBFLOW:

1. Create a new page or section for the application
2. Add an HTML Embed element
3. Paste this entire code into the embed element
4. Update CONFIG.FORM_APP_URL to your actual Netlify domain
5. Update CONFIG.ANALYTICS_ID to your Google Analytics ID
6. Publish your Webflow site

CUSTOMIZATION:
- Modify styles to match your Webflow theme
- Update button colors to match WareWorks branding
- Add additional tracking events as needed
- Customize the disclaimer text for your requirements

TESTING:
- Test both language options
- Verify analytics tracking
- Check mobile responsiveness
- Test with UTM parameters
-->