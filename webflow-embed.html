<!-- 
WareWorks Application Form - Webflow Embed Code
Copy this code into your Webflow embed element
-->

<div id="wareworks-application-embed" style="width: 100%; min-height: 600px;">
  <!-- Language Selection Disclaimer -->
  <div id="language-disclaimer" style="
    background: white; 
    border-radius: 0.75rem; 
    padding: 2.5rem; 
    text-align: center; 
    box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
    margin-bottom: 1.25rem; 
    max-width: 50rem; 
    margin: 0 auto 1.25rem;
    font-family: 'Figtree', sans-serif;
  ">
    <h2 style="
      color: #131f5b; 
      margin-bottom: 0.625rem; 
      font-family: 'Bricolage Grotesque', sans-serif; 
      font-size: 1.75rem;
      font-weight: 400;
      letter-spacing: -0.01em;
      line-height: 1.04em;
      margin-bottom: 0.35em;
    ">
      Welcome to WareWorks
    </h2>
    <h3 style="
      color: #666; 
      margin-bottom: 1.875rem; 
      font-family: 'Bricolage Grotesque', sans-serif; 
      font-size: 1.5rem; 
      font-weight: 400;
      letter-spacing: -0.01em;
      line-height: 1.04em;
      margin-bottom: 0.7em;
    ">
      Bienvenido a WareWorks
    </h3>
    
    <!-- Comprehensive Employment Eligibility Notice -->
    <div style="
      text-align: left; 
      margin-bottom: 1.875rem; 
      line-height: 1.6; 
      background: #eff1f7; 
      padding: 1.5rem; 
      border-radius: 0.75rem;
      border: 1px solid #d1d9e6;
    ">
      <div style="margin-bottom: 1.25rem;">
        <h4 style="
          margin-bottom: 0.75rem; 
          font-size: 1rem;
          font-family: 'Bricolage Grotesque', sans-serif;
          font-weight: 600;
          color: #131f5b;
        ">Employment Eligibility Requirements</h4>
        <p style="
          margin-bottom: 0.75rem; 
          font-size: 0.88rem;
          font-family: 'Figtree', sans-serif;
          line-height: 1.6em;
          color: #080c24;
        ">
          <strong>English:</strong> All employees must be eligible to work in the United States. You will be required to provide documentation to verify your eligibility as part of the I-9 process. Federal law requires all employers to verify the identity and employment eligibility of all employees. You will need to provide acceptable documentation within three (3) business days of starting employment.
        </p>
        <p style="
          margin-bottom: 0.75rem; 
          font-size: 0.88rem;
          font-family: 'Figtree', sans-serif;
          line-height: 1.6em;
          color: #080c24;
        ">
          <strong>Document Requirements:</strong> Accepted formats include PDF, JPG, JPEG, PNG. Maximum file size is 10MB per file. Documents must be clear and legible with personal information visible.
        </p>
      </div>
      
      <div style="margin-bottom: 1.25rem;">
        <h4 style="
          margin-bottom: 0.75rem; 
          font-size: 1rem;
          font-family: 'Bricolage Grotesque', sans-serif;
          font-weight: 600;
          color: #131f5b;
        ">Requisitos de Elegibilidad de Empleo</h4>
        <p style="
          margin-bottom: 0.75rem; 
          font-size: 0.88rem;
          font-family: 'Figtree', sans-serif;
          line-height: 1.6em;
          color: #080c24;
        ">
          <strong>Español:</strong> Todos los empleados deben ser elegibles para trabajar en los Estados Unidos. Se le requerirá proporcionar documentación para verificar su elegibilidad como parte del proceso I-9. La ley federal requiere que todos los empleadores verifiquen la identidad y elegibilidad de empleo de todos los empleados. Necesitará proporcionar documentación aceptable dentro de tres (3) días hábiles de comenzar el empleo.
        </p>
        <p style="
          margin-bottom: 0; 
          font-size: 0.88rem;
          font-family: 'Figtree', sans-serif;
          line-height: 1.6em;
          color: #080c24;
        ">
          <strong>Requisitos de Documentos:</strong> Los formatos aceptados incluyen PDF, JPG, JPEG, PNG. El tamaño máximo de archivo es 10MB por archivo. Los documentos deben ser claros y legibles con información personal visible.
        </p>
      </div>

      <div style="
        background: #fef3cd;
        border: 1px solid #fde68a;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
      ">
        <p style="
          margin: 0; 
          font-size: 0.85rem;
          font-family: 'Figtree', sans-serif;
          line-height: 1.5em;
          color: #92400e;
          font-weight: 500;
        ">
          <strong>Privacy Notice:</strong> By continuing, you acknowledge that the information you provide will be used for employment purposes and will be kept confidential according to applicable laws. All information provided will be verified during the background check process.
        </p>
      </div>
    </div>
    
    <p style="
      margin-bottom: 1.5625rem; 
      color: #666; 
      font-size: 1rem;
      font-family: 'Figtree', sans-serif;
      line-height: 1.6em;
    ">
      Please select your preferred language:
    </p>
    <div class="button-container" style="display: flex; gap: 0.9375rem; justify-content: center; flex-wrap: wrap;">
      <button onclick="loadApplicationEmbed('en')" style="
        background: #131f5b; 
        color: white; 
        border: none; 
        padding: 1em 1.5em; 
        border-radius: 0.25rem; 
        cursor: pointer; 
        font-size: 1rem; 
        min-width: 12.5rem; 
        transition: all 0.2s ease;
        font-family: 'Figtree', sans-serif;
        font-weight: 400;
      " onmouseover="this.style.background='#1e308e'; this.style.transform='translateY(-1px)'" onmouseout="this.style.background='#131f5b'; this.style.transform='none'">
        Accept & Continue in English
      </button>
      <button onclick="loadApplicationEmbed('es')" style="
        background: #131f5b; 
        color: white; 
        border: none; 
        padding: 1em 1.5em; 
        border-radius: 0.25rem; 
        cursor: pointer; 
        font-size: 1rem; 
        min-width: 12.5rem; 
        transition: all 0.2s ease;
        font-family: 'Figtree', sans-serif;
        font-weight: 400;
      " onmouseover="this.style.background='#1e308e'; this.style.transform='translateY(-1px)'" onmouseout="this.style.background='#131f5b'; this.style.transform='none'">
        Aceptar y Continuar en Español
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div id="application-loading" style="
    display: none; 
    text-align: center; 
    padding: 3rem;
    font-family: 'Figtree', sans-serif;
  ">
    <div style="
      width: 2.5rem; 
      height: 2.5rem; 
      border: 0.25rem solid #eff1f7; 
      border-top: 0.25rem solid #131f5b; 
      border-radius: 50%; 
      animation: spin 1s linear infinite; 
      margin: 0 auto 1rem;
    "></div>
    <p style="
      color: #666; 
      font-size: 1rem;
      font-family: 'Figtree', sans-serif;
      line-height: 1.6em;
      margin: 0;
    ">
      Loading application...
    </p>
  </div>

  <!-- Progress Bar Container (shown after language selection) -->
  <div id="progress-bar-container" style="display: none; width: 100%;">
    <!-- Progress bar will be injected here -->
  </div>

  <!-- Application Container -->
  <div id="application-container" style="display: none; width: 100%;">
    <!-- The standalone application will be loaded here -->
  </div>
</div>

<style>
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  @import url('https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Figtree:ital,wght@0,300..900;1,300..900&display=swap');
  
  /* Responsive styles following style guide breakpoints */
  @media (max-width: 768px) {
    #language-disclaimer {
      margin: 0 1rem 1.25rem !important;
      padding: 1.5rem !important;
    }
    
    #language-disclaimer h2 {
      font-size: 1.52rem !important;
    }
    
    #language-disclaimer h3 {
      font-size: 1.3rem !important;
    }
    
    #language-disclaimer .button-container {
      flex-direction: column !important;
    }
    
    #language-disclaimer button {
      min-width: 100% !important;
    }
  }
  
  @media (max-width: 480px) {
    #language-disclaimer h2 {
      font-size: 1.21rem !important;
    }
    
    #language-disclaimer h3 {
      font-size: 1.2rem !important;
    }
  }
</style>

<script>
(function() {
  'use strict';
  
  // Configuration
  const CONFIG = {
    // Use localhost for development, replace with your actual Netlify URL when deployed
    FORM_APP_URL: window.location.hostname === 'localhost' || window.location.hostname.includes('webflow.io') 
      ? 'http://localhost:3000' 
      : 'https://wareworks-backend.netlify.app', // Your actual Netlify URL
    ANALYTICS_ID: 'G-XXXXXXXXXX', // Replace with your GA4 ID
    WEBFLOW_DOMAIN: window.location.hostname
  };

  // Analytics tracking
  function trackEvent(eventName, parameters = {}) {
    if (typeof gtag !== 'undefined') {
      gtag('event', eventName, {
        ...parameters,
        source: 'webflow_embed',
        webflow_domain: CONFIG.WEBFLOW_DOMAIN
      });
    }
  }

  // Start application with language selection
  window.startApplication = function(language = 'en') {
    console.log('Starting WareWorks application in language:', language);
    
    // Track application start
    trackEvent('application_start', {
      language: language,
      referrer: CONFIG.WEBFLOW_DOMAIN
    });
    
    // Hide disclaimer, show loading
    document.getElementById('language-disclaimer').style.display = 'none';
    document.getElementById('application-loading').style.display = 'block';
    
    // Build application URL with parameters
    const url = new URL(CONFIG.FORM_APP_URL);
    url.searchParams.set('lang', language);
    url.searchParams.set('source', 'webflow');
    url.searchParams.set('referrer', CONFIG.WEBFLOW_DOMAIN);
    
    // Add UTM parameters if present
    const urlParams = new URLSearchParams(window.location.search);
    ['utm_source', 'utm_medium', 'utm_campaign', 'utm_content'].forEach(param => {
      if (urlParams.has(param)) {
        url.searchParams.set(param, urlParams.get(param));
      }
    });
    
    // Redirect to standalone application
    setTimeout(() => {
      window.location.href = url.toString();
    }, 500);
  };

  // State management for application
  let currentState = {
    language: 'en',
    currentStep: 0,
    totalSteps: 8,
    completedSteps: [],
    steps: [
      'Personal Information',
      'Contact Details', 
      'Work Authorization',
      'Position & Experience',
      'Availability & Preferences',
      'Education & Employment',
      'Documents',
      'Review & Submit'
    ]
  };

  // Load application in iframe (embedded approach)
  window.loadApplicationEmbed = function(language = 'en') {
    console.log('Loading WareWorks application in iframe, language:', language);
    
    // Track application start
    trackEvent('application_start', {
      language: language,
      referrer: CONFIG.WEBFLOW_DOMAIN,
      mode: 'embedded'
    });
    
    currentState.language = language;
    
    const container = document.getElementById('application-container');
    const loading = document.getElementById('application-loading');
    const disclaimer = document.getElementById('language-disclaimer');
    const progressContainer = document.getElementById('progress-bar-container');
    
    // Show loading first
    disclaimer.style.display = 'none';
    loading.style.display = 'block';
    
    // After a brief moment, show progress bar and load the iframe
    setTimeout(() => {
      loading.style.display = 'none';
      
      // Show and initialize progress bar
      progressContainer.style.display = 'block';
      updateProgressBar();
      
      container.style.display = 'block';
    
      // Build application URL with parameters
      const url = new URL(CONFIG.FORM_APP_URL);
      url.searchParams.set('lang', language);
      url.searchParams.set('embed', 'true');
      url.searchParams.set('source', 'webflow');
      url.searchParams.set('referrer', CONFIG.WEBFLOW_DOMAIN);
      
      // Add UTM parameters if present
      const urlParams = new URLSearchParams(window.location.search);
      ['utm_source', 'utm_medium', 'utm_campaign', 'utm_content'].forEach(param => {
        if (urlParams.has(param)) {
          url.searchParams.set(param, urlParams.get(param));
        }
      });
    
      // Create iframe
      const iframe = document.createElement('iframe');
      iframe.src = url.toString();
      iframe.style.width = '100%';
      iframe.style.height = '600px'; // Initial height, will be adjusted
      iframe.style.border = 'none';
      iframe.style.borderRadius = '8px';
      iframe.style.overflow = 'hidden';
      iframe.style.transition = 'height 0.3s ease';
      
      // Handle iframe messages for height adjustment and progress updates
      window.addEventListener('message', function(event) {
        if (event.origin === new URL(CONFIG.FORM_APP_URL).origin) {
          if (event.data.type === 'resize') {
            const newHeight = event.data.height;
            iframe.style.height = newHeight + 'px';
            console.log('Iframe height adjusted to:', newHeight + 'px');
          }
          if (event.data.type === 'step_change') {
            currentState.currentStep = event.data.currentStep;
            currentState.completedSteps = event.data.completedSteps || [];
            updateProgressBar();
            console.log('Step changed to:', event.data.currentStep);
          }
          if (event.data.type === 'application_complete') {
            trackEvent('application_complete', event.data.details);
          }
        }
      });
      
      // Add onload event to request initial height
      iframe.onload = function() {
        console.log('Iframe loaded, requesting height adjustment');
        iframe.contentWindow.postMessage({ type: 'requestHeight' }, '*');
      };
      
      container.appendChild(iframe);
    }, 500);
  };

  // Update progress bar HTML
  function updateProgressBar() {
    const progressContainer = document.getElementById('progress-bar-container');
    if (!progressContainer) return;
    
    const progress = ((currentState.currentStep + 1) / currentState.totalSteps) * 100;
    
    progressContainer.innerHTML = `
      <div style="
        background: white; 
        border-bottom: 1px solid #e5e7eb; 
        padding: 1rem; 
        margin-bottom: 1rem;
        font-family: 'Figtree', sans-serif;
      ">
        <!-- Header with Language Selector -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <div style="display: flex; align-items: center; gap: 0.75rem;">
            <div style="
              width: 2rem; 
              height: 2rem; 
              background: linear-gradient(to right, #2563eb, #1d4ed8); 
              border-radius: 0.5rem; 
              display: flex; 
              align-items: center; 
              justify-content: center;
            ">
              <span style="color: white; font-weight: bold; font-size: 0.875rem;">W</span>
            </div>
            <div>
              <h3 style="font-size: 0.875rem; font-weight: 600; color: #111827; margin: 0;">WareWorks Application</h3>
              <p style="font-size: 0.75rem; color: #6b7280; margin: 0;">
                Step ${currentState.currentStep + 1} of ${currentState.totalSteps} • ${currentState.steps[currentState.currentStep]}
              </p>
            </div>
          </div>
          
          <!-- Language Selector -->
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <svg style="width: 1rem; height: 1rem; color: #6b7280;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
            </svg>
            <select id="language-selector" onchange="changeLanguage(this.value)" style="
              font-size: 0.75rem; 
              border: 1px solid #d1d5db; 
              border-radius: 0.25rem; 
              padding: 0.25rem 0.5rem;
              background: white;
            ">
              <option value="en" ${currentState.language === 'en' ? 'selected' : ''}>English</option>
              <option value="es" ${currentState.language === 'es' ? 'selected' : ''}>Español</option>
            </select>
          </div>
        </div>
        
        <!-- Progress Bar -->
        <div style="
          width: 100%; 
          background: #e5e7eb; 
          border-radius: 9999px; 
          height: 0.5rem; 
          margin-bottom: 1rem;
        ">
          <div style="
            background: linear-gradient(to right, #2563eb, #1d4ed8); 
            height: 0.5rem; 
            border-radius: 9999px; 
            transition: all 0.3s ease-out;
            width: ${progress}%;
          "></div>
        </div>
        
        <!-- Step Indicators -->
        <div style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem;">
          ${currentState.steps.map((step, index) => {
            const isCompleted = currentState.completedSteps.includes(index);
            const isCurrent = index === currentState.currentStep;
            const isClickable = index <= currentState.currentStep || isCompleted;
            
            return `
              <div style="
                display: flex; 
                flex-direction: column; 
                align-items: center; 
                flex: 1; 
                min-width: 60px;
                ${isClickable ? 'cursor: pointer;' : ''}
              " onclick="${isClickable ? `navigateToStep(${index})` : ''}" title="${step}">
                <div style="
                  width: 1.5rem; 
                  height: 1.5rem; 
                  border-radius: 50%; 
                  display: flex; 
                  align-items: center; 
                  justify-content: center; 
                  font-size: 0.75rem; 
                  font-weight: 500; 
                  margin-bottom: 0.25rem; 
                  transition: all 0.2s;
                  ${isCurrent 
                    ? 'background: #2563eb; color: white; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.2);' 
                    : isCompleted
                    ? 'background: #10b981; color: white;'
                    : index < currentState.currentStep
                    ? 'background: #2563eb; color: white;'
                    : 'background: #e5e7eb; color: #6b7280;'
                  }
                  ${isClickable ? 'transform: scale(1); transition: transform 0.2s;' : ''}
                " onmouseover="${isClickable ? 'this.style.transform=\'scale(1.1)\'' : ''}" 
                   onmouseout="${isClickable ? 'this.style.transform=\'scale(1)\'' : ''}">
                  ${isCompleted ? '✓' : index + 1}
                </div>
                <span style="
                  font-size: 0.625rem; 
                  text-align: center; 
                  line-height: 1.2; 
                  max-width: 100%; 
                  overflow: hidden; 
                  text-overflow: ellipsis; 
                  white-space: nowrap;
                  ${isCurrent || isCompleted
                    ? 'color: #2563eb; font-weight: 500;' 
                    : index < currentState.currentStep
                    ? 'color: #374151;'
                    : 'color: #9ca3af;'
                  }
                ">
                  ${step}
                </span>
              </div>
            `;
          }).join('')}
        </div>
      </div>
    `;
  }

  // Navigate to specific step
  window.navigateToStep = function(stepIndex) {
    console.log('Navigating to step:', stepIndex);
    
    // Send message to iframe to change step
    const iframe = document.querySelector('#application-container iframe');
    if (iframe && iframe.contentWindow) {
      iframe.contentWindow.postMessage({
        type: 'navigate_to_step',
        stepIndex: stepIndex
      }, '*');
    }
  };

  // Change language
  window.changeLanguage = function(newLanguage) {
    console.log('Changing language to:', newLanguage);
    
    currentState.language = newLanguage;
    updateProgressBar();
    
    // Send message to iframe to change language
    const iframe = document.querySelector('#application-container iframe');
    if (iframe && iframe.contentWindow) {
      iframe.contentWindow.postMessage({
        type: 'language_change',
        language: newLanguage
      }, '*');
    }
  };

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      console.log('WareWorks application embed initialized');
    });
  }
})();
</script>

<!-- 
INSTRUCTIONS FOR WEBFLOW:

1. Create a new page or section for the application
2. Add an HTML Embed element
3. Paste this entire code into the embed element
4. Update CONFIG.FORM_APP_URL to your actual Netlify domain
5. Update CONFIG.ANALYTICS_ID to your Google Analytics ID
6. Publish your Webflow site

CUSTOMIZATION:
- Modify styles to match your Webflow theme
- Update button colors to match WareWorks branding
- Add additional tracking events as needed
- Customize the disclaimer text for your requirements

TESTING:
- Test both language options
- Verify analytics tracking
- Check mobile responsiveness
- Test with UTM parameters
-->