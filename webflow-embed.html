<!-- 
WareWorks Application Form - Webflow Embed Code
Copy this code into your Webflow embed element
-->

<div id="wareworks-application-embed" style="width: 100%; min-height: 600px;">
  <!-- Language Selection Disclaimer -->
  <div id="language-disclaimer" style="
    background: white; 
    border-radius: 0.75rem; 
    padding: 2.5rem; 
    text-align: center; 
    box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
    margin-bottom: 1.25rem; 
    max-width: 50rem; 
    margin: 0 auto 1.25rem;
    font-family: 'Figtree', sans-serif;
  ">
    <!-- Modern Language Toggle - MOVED TO TOP -->
    <div style="display: flex; justify-content: center; margin-bottom: 1.875rem;">
      <div id="language-toggle" style="
        background: #f3f4f6; 
        border-radius: 0.5rem; 
        padding: 0.25rem; 
        display: flex;
        position: relative;
        max-width: 320px;
        width: 100%;
      ">
        <button 
          id="btn-english" 
          onclick="selectLanguage('en')" 
          style="
            flex: 1;
            padding: 0.75rem 1.5rem; 
            border-radius: 0.375rem; 
            font-weight: 500; 
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            font-family: 'Figtree', sans-serif;
            font-size: 0.95rem;
            background: white;
            color: #131f5b;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
          "
        >
          English
        </button>
        <button 
          id="btn-spanish" 
          onclick="selectLanguage('es')" 
          style="
            flex: 1;
            padding: 0.75rem 1.5rem; 
            border-radius: 0.375rem; 
            font-weight: 500; 
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
            font-family: 'Figtree', sans-serif;
            font-size: 0.95rem;
            background: transparent;
            color: #6b7280;
          "
        >
          Español
        </button>
      </div>
    </div>

    <!-- Dynamic Title -->
    <h2 id="disclaimer-title" style="
      color: #131f5b; 
      margin-bottom: 1.875rem; 
      font-family: 'Bricolage Grotesque', sans-serif; 
      font-size: 1.75rem;
      font-weight: 400;
      letter-spacing: -0.01em;
      line-height: 1.04em;
    ">
      Welcome to WareWorks
    </h2>
    
    <!-- Employment Eligibility Notice -->
    <div id="disclaimer-content" style="
      text-align: left; 
      margin-bottom: 1.875rem; 
      line-height: 1.6; 
      background: #eff1f7; 
      padding: 1.5rem; 
      border-radius: 0.75rem;
      border: 1px solid #d1d9e6;
    ">
      <!-- Content will be dynamically updated based on language selection -->
      <div id="disclaimer-text">
        <h4 style="
          margin-bottom: 0.75rem; 
          font-size: 1rem;
          font-family: 'Bricolage Grotesque', sans-serif;
          font-weight: 600;
          color: #131f5b;
        ">Employment Eligibility Requirements</h4>
        <p style="
          margin-bottom: 0.75rem; 
          font-size: 0.88rem;
          font-family: 'Figtree', sans-serif;
          line-height: 1.6em;
          color: #080c24;
        ">
          All employees must be eligible to work in the United States. You will be required to provide documentation to verify your eligibility as part of the I-9 process. Federal law requires all employers to verify the identity and employment eligibility of all employees. You will need to provide acceptable documentation within three (3) business days of starting employment.
        </p>
        <p style="
          margin-bottom: 0.75rem; 
          font-size: 0.88rem;
          font-family: 'Figtree', sans-serif;
          line-height: 1.6em;
          color: #080c24;
        ">
          <strong>Document Requirements:</strong> Accepted formats include PDF, JPG, JPEG, PNG. Maximum file size is 10MB per file. Documents must be clear and legible with personal information visible.
        </p>

        <div style="
          background: #fef3cd;
          border: 1px solid #fde68a;
          border-radius: 0.5rem;
          padding: 1rem;
          margin-top: 1rem;
        ">
          <p style="
            margin: 0; 
            font-size: 0.85rem;
            font-family: 'Figtree', sans-serif;
            line-height: 1.5em;
            color: #92400e;
            font-weight: 500;
          ">
            <strong>Privacy Notice:</strong> By continuing, you acknowledge that the information you provide will be used for employment purposes and will be kept confidential according to applicable laws. All information provided will be verified during the background check process.
          </p>
        </div>
      </div>
    </div>
    
    
    <!-- Single Continue Button -->
    <button
      id="continue-button"
      onclick="continueWithSelectedLanguage()"
      style="
        width: 100%; 
        max-width: 320px;
        background: #131f5b; 
        color: white; 
        border: none;
        padding: 1rem 2rem; 
        border-radius: 0.5rem; 
        font-weight: 500; 
        font-size: 1rem;
        cursor: pointer; 
        transition: all 0.2s ease;
        font-family: 'Figtree', sans-serif;
        box-shadow: 0 4px 12px rgba(19, 31, 91, 0.15);
      " 
      onmouseover="this.style.background='#1e308e'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 6px 20px rgba(19, 31, 91, 0.25)'" 
      onmouseout="this.style.background='#131f5b'; this.style.transform='none'; this.style.boxShadow='0 4px 12px rgba(19, 31, 91, 0.15)'"
    >
      Accept & Continue
    </button>
  </div>

  <!-- Loading State -->
  <div id="application-loading" style="
    display: none; 
    text-align: center; 
    padding: 3rem;
    font-family: 'Figtree', sans-serif;
    background: white;
    border-radius: 0.75rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    margin: 0 auto;
    max-width: 50rem;
  ">
    <div style="
      width: 3rem; 
      height: 3rem; 
      border: 0.25rem solid #e5e7eb; 
      border-top: 0.25rem solid #2563eb; 
      border-radius: 50%; 
      animation: spin 1s linear infinite; 
      margin: 0 auto 1.5rem;
    "></div>
    <h3 id="loading-title" style="
      color: #111827; 
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      font-family: 'Figtree', sans-serif;
    ">
      Loading Application
    </h3>
    <p id="loading-text" style="
      color: #6b7280; 
      font-size: 0.875rem;
      font-family: 'Figtree', sans-serif;
      line-height: 1.5;
      margin: 0;
    ">
      Please wait while we prepare your application form...
    </p>
  </div>

  <!-- Progress Bar Container (shown after language selection) -->
  <div id="progress-bar-container" style="display: none; width: 100%;">
    <!-- Progress bar will be injected here -->
  </div>

  <!-- Application Container -->
  <div id="application-container" style="display: none; width: 100%;">
    <!-- The standalone application will be loaded here -->
  </div>
</div>

<style>
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  @import url('https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&family=Figtree:ital,wght@0,300..900;1,300..900&display=swap');
  
  /* Responsive styles following style guide breakpoints */
  @media (max-width: 768px) {
    #language-disclaimer {
      margin: 0 1rem 1.25rem !important;
      padding: 1.5rem !important;
    }
    
    #disclaimer-title {
      font-size: 1.52rem !important;
    }
    
    #language-toggle {
      max-width: 100% !important;
    }
    
    #continue-button {
      max-width: 100% !important;
    }
  }
  
  @media (max-width: 480px) {
    #disclaimer-title {
      font-size: 1.21rem !important;
    }
  }
</style>

<script>
// Track selected language globally so onclick can access it
window.selectedLanguage = 'en';

(function() {
  'use strict';
  
  // Configuration
  const CONFIG = {
    // Use localhost for development, replace with your actual Netlify URL when deployed
    FORM_APP_URL: window.location.hostname === 'localhost' || window.location.hostname.includes('webflow.io') 
      ? 'http://localhost:3000' 
      : 'https://wareworks-backend.netlify.app', // Your actual Netlify URL
    ANALYTICS_ID: 'G-XXXXXXXXXX', // Replace with your GA4 ID
    WEBFLOW_DOMAIN: window.location.hostname
  };

  // Static translations for disclaimer
  const translations = {
    en: {
      title: 'Welcome to WareWorks',
      eligibilityTitle: 'Employment Eligibility Requirements',
      eligibilityText: 'All employees must be eligible to work in the United States. You will be required to provide documentation to verify your eligibility as part of the I-9 process. Federal law requires all employers to verify the identity and employment eligibility of all employees. You will need to provide acceptable documentation within three (3) business days of starting employment.',
      documentRequirements: 'Document Requirements:',
      documentText: 'Accepted formats include PDF, JPG, JPEG, PNG. Maximum file size is 10MB per file. Documents must be clear and legible with personal information visible.',
      privacyNotice: 'Privacy Notice:',
      privacyText: 'By continuing, you acknowledge that the information you provide will be used for employment purposes and will be kept confidential according to applicable laws. All information provided will be verified during the background check process.',
      instruction: 'Please select your preferred language:',
      loadingTitle: 'Loading Application',
      loadingText: 'Please wait while we prepare your application form...'
    },
    es: {
      title: 'Bienvenido a WareWorks',
      eligibilityTitle: 'Requisitos de Elegibilidad de Empleo',
      eligibilityText: 'Todos los empleados deben ser elegibles para trabajar en los Estados Unidos. Se le requerirá proporcionar documentación para verificar su elegibilidad como parte del proceso I-9. La ley federal requiere que todos los empleadores verifiquen la identidad y elegibilidad de empleo de todos los empleados. Necesitará proporcionar documentación aceptable dentro de tres (3) días hábiles de comenzar el empleo.',
      documentRequirements: 'Requisitos de Documentos:',
      documentText: 'Los formatos aceptados incluyen PDF, JPG, JPEG, PNG. El tamaño máximo de archivo es 10MB por archivo. Los documentos deben ser claros y legibles con información personal visible.',
      privacyNotice: 'Aviso de Privacidad:',
      privacyText: 'Al continuar, usted reconoce que la información que proporcione será utilizada para fines de empleo y se mantendrá confidencial de acuerdo con las leyes aplicables. Toda la información proporcionada será verificada durante el proceso de verificación de antecedentes.',
      instruction: 'Por favor seleccione su idioma preferido:',
      loadingTitle: 'Cargando Aplicación',
      loadingText: 'Por favor espere mientras preparamos su formulario de solicitud...'
    }
  };

  // Analytics tracking
  function trackEvent(eventName, parameters = {}) {
    if (typeof gtag !== 'undefined') {
      gtag('event', eventName, {
        ...parameters,
        source: 'webflow_embed',
        webflow_domain: CONFIG.WEBFLOW_DOMAIN
      });
    }
  }

  // Update disclaimer content based on selected language
  function updateDisclaimerContent(language) {
    const t = translations[language];
    
    document.getElementById('disclaimer-title').textContent = t.title;
    document.getElementById('language-instruction').textContent = t.instruction;
    
    // Update loading text too
    document.getElementById('loading-title').textContent = t.loadingTitle;
    document.getElementById('loading-text').textContent = t.loadingText;
    
    // Update disclaimer content
    document.getElementById('disclaimer-text').innerHTML = `
      <h4 style="
        margin-bottom: 0.75rem; 
        font-size: 1rem;
        font-family: 'Bricolage Grotesque', sans-serif;
        font-weight: 600;
        color: #131f5b;
      ">${t.eligibilityTitle}</h4>
      <p style="
        margin-bottom: 0.75rem; 
        font-size: 0.88rem;
        font-family: 'Figtree', sans-serif;
        line-height: 1.6em;
        color: #080c24;
      ">
        ${t.eligibilityText}
      </p>
      <p style="
        margin-bottom: 0.75rem; 
        font-size: 0.88rem;
        font-family: 'Figtree', sans-serif;
        line-height: 1.6em;
        color: #080c24;
      ">
        <strong>${t.documentRequirements}</strong> ${t.documentText}
      </p>

      <div style="
        background: #fef3cd;
        border: 1px solid #fde68a;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-top: 1rem;
      ">
        <p style="
          margin: 0; 
          font-size: 0.85rem;
          font-family: 'Figtree', sans-serif;
          line-height: 1.5em;
          color: #92400e;
          font-weight: 500;
        ">
          <strong>${t.privacyNotice}</strong> ${t.privacyText}
        </p>
      </div>
    `;
  }

  // Language selection handler
  window.selectLanguage = function(language) {
    window.selectedLanguage = language;
    
    // Update toggle button states
    const englishBtn = document.getElementById('btn-english');
    const spanishBtn = document.getElementById('btn-spanish');
    
    if (language === 'en') {
      englishBtn.style.background = 'white';
      englishBtn.style.color = '#131f5b';
      englishBtn.style.boxShadow = '0 1px 2px rgba(0, 0, 0, 0.05)';
      
      spanishBtn.style.background = 'transparent';
      spanishBtn.style.color = '#6b7280';
      spanishBtn.style.boxShadow = 'none';
    } else {
      spanishBtn.style.background = 'white';
      spanishBtn.style.color = '#131f5b';
      spanishBtn.style.boxShadow = '0 1px 2px rgba(0, 0, 0, 0.05)';
      
      englishBtn.style.background = 'transparent';
      englishBtn.style.color = '#6b7280';
      englishBtn.style.boxShadow = 'none';
    }

    // Update disclaimer content
    updateDisclaimerContent(language);
  };

  // Continue button wrapper function that can access global selectedLanguage
  window.continueWithSelectedLanguage = function() {
    loadApplicationEmbed(window.selectedLanguage);
  };

  // State management for application
  let currentState = {
    language: 'en',
    currentStep: 0,
    totalSteps: 8,
    completedSteps: [],
    steps: [
      'Personal Information',
      'Contact Details', 
      'Work Authorization',
      'Position & Experience',
      'Availability & Preferences',
      'Education & Employment',
      'Documents',
      'Review & Submit'
    ]
  };

  // Load application in iframe (embedded approach)
  window.loadApplicationEmbed = function(language = 'en') {
    console.log('Loading WareWorks application in iframe, language:', language);
    
    // Track application start
    trackEvent('application_start', {
      language: language,
      referrer: CONFIG.WEBFLOW_DOMAIN,
      mode: 'embedded'
    });
    
    currentState.language = language;
    
    const container = document.getElementById('application-container');
    const loading = document.getElementById('application-loading');
    const disclaimer = document.getElementById('language-disclaimer');
    const progressContainer = document.getElementById('progress-bar-container');
    
    // Show loading first
    disclaimer.style.display = 'none';
    loading.style.display = 'block';
    
    // After a brief moment, show progress bar and load the iframe
    setTimeout(() => {
      // Scroll to top for consistent experience
      window.scrollTo({ top: 0, behavior: 'smooth' });
      
      loading.style.display = 'none';
      
      // Show and initialize progress bar
      progressContainer.style.display = 'block';
      updateProgressBar();
      
      container.style.display = 'block';
    
      // Build application URL with parameters - THIS IS THE KEY CONNECTION!
      const url = new URL(CONFIG.FORM_APP_URL);
      url.searchParams.set('lang', language); // This passes language to React app
      url.searchParams.set('embed', 'true');
      url.searchParams.set('source', 'webflow');
      url.searchParams.set('referrer', CONFIG.WEBFLOW_DOMAIN);
      
      // Add UTM parameters if present
      const urlParams = new URLSearchParams(window.location.search);
      ['utm_source', 'utm_medium', 'utm_campaign', 'utm_content'].forEach(param => {
        if (urlParams.has(param)) {
          url.searchParams.set(param, urlParams.get(param));
        }
      });
    
      // Create iframe
      const iframe = document.createElement('iframe');
      iframe.src = url.toString();
      iframe.style.width = '100%';
      iframe.style.height = '600px'; // Initial height, will be adjusted
      iframe.style.border = 'none';
      iframe.style.borderRadius = '8px';
      iframe.style.overflow = 'hidden';
      iframe.style.transition = 'height 0.3s ease';
      
      // Handle iframe messages for height adjustment and progress updates
      window.addEventListener('message', function(event) {
        // Validate origin for security
        const allowedOrigins = [
          new URL(CONFIG.FORM_APP_URL).origin,
          'http://localhost:3000',
          'https://wareworks-backend.netlify.app'
        ];
        
        if (!allowedOrigins.includes(event.origin)) {
          console.warn('Rejected message from unauthorized origin:', event.origin);
          return;
        }

        // Validate message structure
        if (!event.data || typeof event.data.type !== 'string') {
          console.warn('Invalid message format received');
          return;
        }

        if (event.data.type === 'resize') {
          const newHeight = event.data.height;
          if (typeof newHeight === 'number' && newHeight > 0 && newHeight < 10000) {
            iframe.style.height = newHeight + 'px';
            console.log('Iframe height adjusted to:', newHeight + 'px');
          }
        }
        if (event.data.type === 'step_change') {
          const stepData = event.data;
          if (typeof stepData.currentStep === 'number' && 
              stepData.currentStep >= 0 && 
              stepData.currentStep < currentState.totalSteps) {
            currentState.currentStep = stepData.currentStep;
            currentState.completedSteps = Array.isArray(stepData.completedSteps) ? stepData.completedSteps : [];
            updateProgressBar();
            console.log('Step changed to:', stepData.currentStep);
          }
        }
        if (event.data.type === 'application_complete') {
          trackEvent('application_complete', event.data.details);
        }
      });
      
      // Add onload event to request initial height
      iframe.onload = function() {
        console.log('Iframe loaded, requesting height adjustment');
        iframe.contentWindow.postMessage({ type: 'requestHeight' }, '*');
      };
      
      container.appendChild(iframe);
    }, 500);
  };

  // Update progress bar HTML
  function updateProgressBar() {
    const progressContainer = document.getElementById('progress-bar-container');
    if (!progressContainer) return;
    
    const progress = ((currentState.currentStep + 1) / currentState.totalSteps) * 100;
    
    progressContainer.innerHTML = `
      <div style="
        background: white; 
        border-bottom: 1px solid #e5e7eb; 
        padding: 1rem; 
        margin-bottom: 1rem;
        font-family: 'Figtree', sans-serif;
      ">
        <!-- Header with Language Selector -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <div style="display: flex; align-items: center; gap: 0.75rem;">
            <div>
              <p style="font-size: 0.875rem; color: #6b7280; margin: 0;">
                Step ${currentState.currentStep + 1} of ${currentState.totalSteps} • ${currentState.steps[currentState.currentStep]}
              </p>
            </div>
          </div>
          
          <!-- Language Selector -->
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <svg style="width: 1rem; height: 1rem; color: #6b7280;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
            </svg>
            <select id="language-selector" onchange="changeLanguage(this.value)" style="
              font-size: 0.75rem; 
              border: 1px solid #d1d5db; 
              border-radius: 0.25rem; 
              padding: 0.25rem 0.5rem;
              background: white;
            ">
              <option value="en" ${currentState.language === 'en' ? 'selected' : ''}>English</option>
              <option value="es" ${currentState.language === 'es' ? 'selected' : ''}>Español</option>
            </select>
          </div>
        </div>
        
        <!-- Progress Bar -->
        <div style="
          width: 100%; 
          background: #e5e7eb; 
          border-radius: 9999px; 
          height: 0.5rem; 
          margin-bottom: 1rem;
        ">
          <div style="
            background: linear-gradient(to right, #2563eb, #1d4ed8); 
            height: 0.5rem; 
            border-radius: 9999px; 
            transition: all 0.3s ease-out;
            width: ${progress}%;
          "></div>
        </div>
        
        <!-- Step Indicators -->
        <div style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem;">
          ${currentState.steps.map((step, index) => {
            const isCompleted = currentState.completedSteps.includes(index);
            const isCurrent = index === currentState.currentStep;
            const isClickable = index <= currentState.currentStep || isCompleted;
            
            return `
              <div style="
                display: flex; 
                flex-direction: column; 
                align-items: center; 
                flex: 1; 
                min-width: 60px;
                ${isClickable ? 'cursor: pointer;' : ''}
              " onclick="${isClickable ? `navigateToStep(${index})` : ''}" title="${step}">
                <div style="
                  width: 1.5rem; 
                  height: 1.5rem; 
                  border-radius: 50%; 
                  display: flex; 
                  align-items: center; 
                  justify-content: center; 
                  font-size: 0.75rem; 
                  font-weight: 500; 
                  margin-bottom: 0.25rem; 
                  transition: all 0.2s;
                  ${isCurrent 
                    ? 'background: #2563eb; color: white; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.2);' 
                    : isCompleted
                    ? 'background: #10b981; color: white;'
                    : index < currentState.currentStep
                    ? 'background: #2563eb; color: white;'
                    : 'background: #e5e7eb; color: #6b7280;'
                  }
                  ${isClickable ? 'transform: scale(1); transition: transform 0.2s;' : ''}
                " onmouseover="${isClickable ? 'this.style.transform=\'scale(1.1)\'' : ''}" 
                   onmouseout="${isClickable ? 'this.style.transform=\'scale(1)\'' : ''}">
                  ${isCompleted ? '✓' : index + 1}
                </div>
                <span style="
                  font-size: 0.625rem; 
                  text-align: center; 
                  line-height: 1.2; 
                  max-width: 100%; 
                  overflow: hidden; 
                  text-overflow: ellipsis; 
                  white-space: nowrap;
                  ${isCurrent || isCompleted
                    ? 'color: #2563eb; font-weight: 500;' 
                    : index < currentState.currentStep
                    ? 'color: #374151;'
                    : 'color: #9ca3af;'
                  }
                ">
                  ${step}
                </span>
              </div>
            `;
          }).join('')}
        </div>
      </div>
    `;
  }

  // Navigate to specific step
  window.navigateToStep = function(stepIndex) {
    console.log('Navigating to step:', stepIndex);
    
    // Scroll to top for consistent experience
    window.scrollTo({ top: 0, behavior: 'smooth' });
    
    // Send message to iframe to change step
    const iframe = document.querySelector('#application-container iframe');
    if (iframe && iframe.contentWindow) {
      iframe.contentWindow.postMessage({
        type: 'navigate_to_step',
        stepIndex: stepIndex
      }, '*');
    }
  };

  // Change language
  window.changeLanguage = function(newLanguage) {
    console.log('Changing language to:', newLanguage);
    
    currentState.language = newLanguage;
    updateProgressBar();
    
    // Send message to iframe to change language
    const iframe = document.querySelector('#application-container iframe');
    if (iframe && iframe.contentWindow) {
      iframe.contentWindow.postMessage({
        type: 'language_change',
        language: newLanguage
      }, '*');
    }
  };

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      console.log('WareWorks application embed initialized');
      // Set default language selection and update content
      selectLanguage('en');
    });
  } else {
    console.log('WareWorks application embed initialized');
    selectLanguage('en');
  }
})();
</script>

<!-- 
INSTRUCTIONS FOR WEBFLOW:

1. Create a new page or section for the application
2. Add an HTML Embed element
3. Paste this entire code into the embed element
4. Update CONFIG.FORM_APP_URL to your actual Netlify domain
5. Update CONFIG.ANALYTICS_ID to your Google Analytics ID
6. Publish your Webflow site

CUSTOMIZATION:
- Modify styles to match your Webflow theme
- Update button colors to match WareWorks branding
- Add additional tracking events as needed
- Customize the disclaimer text for your requirements

TESTING:
- Test both language options
- Verify analytics tracking
- Check mobile responsiveness
- Test with UTM parameters
-->